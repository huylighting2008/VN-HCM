-- AUTO PARRY QTE - ULTRA SENSITIVE + GUI
-- Draggable status GUI

local Players = game:GetService("Players")
local VirtualInputManager = game:GetService("VirtualInputManager")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- ===== CONFIG =====
local ENABLED = true
local COOLDOWN = 0.02        -- cá»±c nháº¡y
local CENTER_RADIUS = 260    -- quÃ©t rá»™ng
-- ==================

local lastTrigger = 0
local lastText = ""

-- ================= GUI =================
local gui = Instance.new("ScreenGui", playerGui)
gui.Name = "AutoParryStatus"
gui.ResetOnSpawn = false

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 150, 0, 40)
frame.Position = UDim2.new(0.5, -75, 0.8, 0)
frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true

local corner = Instance.new("UICorner", frame)
corner.CornerRadius = UDim.new(0, 8)

local label = Instance.new("TextLabel", frame)
label.Size = UDim2.new(1, 0, 1, 0)
label.BackgroundTransparency = 1
label.Text = "ðŸŸ¢ Auto Parry: ON"
label.TextColor3 = Color3.fromRGB(0, 255, 100)
label.Font = Enum.Font.GothamBold
label.TextSize = 14

-- ======================================

local function isValidKey(text)
    return typeof(text) == "string"
        and #text == 1
        and text:match("%a")
end

local function pressKey(key)
    key = key:upper()
    VirtualInputManager:SendKeyEvent(true, key, false, game)
    task.wait() -- 1 frame
    VirtualInputManager:SendKeyEvent(false, key, false, game)
end

local function getCenter()
    local v = Camera.ViewportSize
    return Vector2.new(v.X / 2, v.Y / 2)
end

RunService.RenderStepped:Connect(function()
    if not ENABLED then return end
    if tick() - lastTrigger < COOLDOWN then return end

    local center = getCenter()
    local best, bestDist

    for _, v in ipairs(playerGui:GetDescendants()) do
        if v:IsA("TextLabel")
            and v.Visible
            and isValidKey(v.Text)
            and v.Text ~= lastText
            and v.AbsoluteSize.X >= 26
        then
            local pos = v.AbsolutePosition + (v.AbsoluteSize / 2)
            local dist = (pos - center).Magnitude

            if dist <= CENTER_RADIUS and (not bestDist or dist < bestDist) then
                best = v
                bestDist = dist
            end
        end
    end

    if best then
        pressKey(best.Text)
        lastText = best.Text
        lastTrigger = tick()
    end
end)
